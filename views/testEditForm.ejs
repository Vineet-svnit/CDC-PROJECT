<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="/bootstrap/css/bootstrap.min.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <link rel="stylesheet" href="/css/testEditForm.css" />
  <title>Edit Test Form</title>
</head>

<body>
  <% // Check if test has started to make inputs read-only
  const readOnlyEdit = hasStarted(test.startTime) ? "readonly" : "";
  const disableSelect = hasStarted(test.startTime) ? "disabled" : "";
    %>
    <form method="POST" action="/test/<%= test._id %>?_method=PUT" class="needs-validation" novalidate>
      <!-- Test form -->
      <div class="card col-md-6 mt-5 mb-4 mx-auto shadow-sm">
        <div class="card-header">
          <h3>Edit Test</h3>
        </div>
        <div class="card-body">
          <div class="mb-3">
            <label for="testName" class="form-label">Test Name</label>
            <input name="testName" value="<%= test.testName %>" placeholder="Enter name of the test" type="text"
              id="testName" class="form-control" required <%=readOnlyEdit %> />
          </div>

          <!-- Date & Time -->
          <div class="row gx-3 mb-3">
            <div class="col">
              <label for="date" class="form-label">Test Date</label>
              <input name="date" value="<%= getDateInput(test.startTime) %>" type="date" id="date"
                class="form-control" required <%=readOnlyEdit %> />
            </div>
            <div class="col">
              <label for="time" class="form-label">Test Timing</label>
              <input name="time"
                value="<%= getTimeInput(test.startTime) %>"
                type="time" id="time" class="form-control" required <%=readOnlyEdit %> />
            </div>
          </div>

          <!-- Duration -->
          <div class="mb-3">
            <label for="duration" class="form-label">Test Duration (in minutes)</label>
            <input name="duration" value="<%= test.duration %>" placeholder="Enter duration" type="number" id="duration"
              class="form-control" min="1" required <%=readOnlyEdit %> />
          </div>

          <div class="mb-3">
            <label for="branch" class="form-label">Branch</label>
            <select class="form-select form-select-lg mb-3" aria-label="Large select example" id="branch" name="branch"
              required disabled>
              <option value="" disabled>Select branch</option>
              <option value="lr" <%=test.branch=='lr' ? "selected" : "" %>>Logical Reasoning and Aptitude</option>
              <option value="ai" <%=test.branch=='ai' ? "selected" : "" %>>Artificial Intelligence</option>
              <option value="che" <%=test.branch=='che' ? "selected" : "" %>>Chemical Engineering</option>
              <option value="chm" <%=test.branch=='chm' ? "selected" : "" %>>Chemistry</option>
              <option value="ce" <%=test.branch=='ce' ? "selected" : "" %>>Civil Engineering</option>
              <option value="cse" <%=test.branch=='cse' ? "selected" : "" %>>Computer Science and Engineering</option>
              <option value="ee" <%=test.branch=='ee' ? "selected" : "" %>>Electrical Engineering</option>
              <option value="ece" <%=test.branch=='ece' ? "selected" : "" %>>Electronics Engineering</option>
              <option value="hss" <%=test.branch=='hss' ? "selected" : "" %>>Humanities and Social Sciences</option>
              <option value="ms" <%=test.branch=='ms' ? "selected" : "" %>>Management Studies</option>
              <option value="math" <%=test.branch=='math' ? "selected" : "" %>>Mathematics</option>
              <option value="me" <%=test.branch=='me' ? "selected" : "" %>>Mechanical Engineering</option>
              <option value="phy" <%=test.branch=='phy' ? "selected" : "" %>>Physics</option>
            </select>
            <input type="hidden" name="branch" value="<%= test.branch %>" />
          </div>

          <div class="mb-3">
            <h5>Categories</h5>
            <ul class="list-group list-group-flush">
              <% test.category.forEach(cat=> { %>
                <li class="list-group-item d-flex justify-content-between align-items-center bg-transparent px-0">
                  <%= cat.category_name %>
                    <span class="badge bg-primary rounded-pill">
                      <%= cat.numberOfQues %> Questions
                    </span>
                </li>
                <% }) %>
            </ul>
          </div>
        </div>
      </div>


      <!-- Test Questions -->
      <% for(let i=0; i < test.numberOfQues; i++) { %>
        <div class="row justify-content-center">
          <div class="col-md-8 mycard mt-4 mb-4">
            <div class="serialNumber">
              <%= i + 1 %>
            </div>
            <div class="mb-3">
              <span class="badge bg-info text-dark">Category: <%= test.questions[i].category %></span>
            </div>

            <div class="row gx-3 mb-3">
              <div class="col-md-12">
                <label for="question<%= i %>" class="form-label">Question</label>
                <input name="questions[<%= i %>][question]" value="<%= test.questions[i].question %>"
                  placeholder="Enter question" type="text" id="question<%= i %>" class="form-control" />
              </div>

              <!-- <div class="col-md-6">
            <label for="questionImage< %= i %>" class="form-label">Question Image</label>
            <input
              name="questions[< %= i %>][questionImage]"
              type="file"
              id="questionImage< %= i %>"
              class="form-control"
            />
          </div> -->
            </div>

            <div class="mb-3">
              <label for="_type<%= i %>" class="form-label">Type of Question</label>
              <select class="form-select" name="questions[<%= i %>][_type]" id="_type<%= i %>" required>
                <option disabled value="" <% if (!test.questions[i]._type) { %>selected<% } %>>
                    Choose...
                </option>
                <option value="SCQ" <% if (test.questions[i]._type==="SCQ" ) { %>selected<% } %>>
                    Single Correct
                </option>
                <option value="MCQ" <% if (test.questions[i]._type==="MCQ" ) { %>selected<% } %>>
                    Multiple Correct
                </option>
              </select>
            </div>

            <p><strong>If Single/Multiple Correct</strong></p>

            <!-- Options 1 to 4 -->
            <% for(let opt=1; opt<=4; opt++) { %>
              <div class="row gx-3 mb-3">
                <div class="col-md-12">
                  <label for="option<%= opt %>_<%= i %>" class="form-label">Enter option <%= opt %></label>
                  <input name="questions[<%= i %>][option<%= opt %>]" value="<%= test.questions[i]['option' + opt] %>"
                    placeholder="Enter option <%= opt %>" type="text" id="option<%= opt %>_<%= i %>"
                    class="form-control" />
                </div>
                <!-- <div class="col-md-6">
            <label for="image< %= opt %>_< %= i %>" class="form-label">Option < %= opt %> Image</label>
            <input
              name="questions[< %= i %>][image< %= opt %>]"
              type="file"
              id="image< %= opt %>_< %= i %>"
              class="form-control"
            />
          </div> -->
              </div>
              <% } %>

                <p><strong>If Single/Multiple Correct</strong></p>
                <div class="mb-3">
                  <label for="answer<%= i %>" class="form-label">Enter Answer ("ABC" for Single/Multiple
                    Correct)</label>
                  <input name="questions[<%= i %>][answer]" value="<%= test.questions[i].answer %>"
                    placeholder="Enter answer" type="text" id="answer<%= i %>" class="form-control" required />
                </div>

                <input type="hidden" name="questions[<%= i %>][_id]" value="<%= test.questions[i]._id.toString() %>" />
          </div>
        </div>
        <% } %>

          <div class="text-center mb-5">
            <button type="submit" class="btn btn-success btn-lg px-5">Update Test</button>
          </div>
    </form>

    <script src="/js/script.js"></script>
    <footer class="custom-footer py-3">
      <div class="container text-center">
        <h6 class="text-white mb-3">Developed By</h6>

        <div class="d-flex justify-content-center gap-5 flex-wrap">

          <!-- Jenil -->
          <div class="dev-profile">
            <span class="dev-name text-white">Jenil Prajapati</span>
            <span class="social-links ms-2">
              <a href="https://github.com/jenil1236" class="text-white mx-1"><i class="fab fa-github"></i></a>
              <a href="https://www.linkedin.com/in/jenil-prajapati-b31505307/" class="text-white mx-1"><i
                  class="fab fa-linkedin"></i></a>
              <a href="#" class="text-white mx-1"><i class="fab fa-twitter"></i></a>
            </span>
          </div>

          <!-- Vineet -->
          <div class="dev-profile">
            <span class="dev-name text-white">Vineet Gupta</span>
            <span class="social-links ms-2">
              <a href="https://github.com/Vineet-svnit" class="text-white mx-1"><i class="fab fa-github"></i></a>
              <a href="https://www.linkedin.com/in/vineet-gupta-431396272/" class="text-white mx-1"><i
                  class="fab fa-linkedin"></i></a>
              <a href="#" class="text-white mx-1"><i class="fab fa-twitter"></i></a>
            </span>
          </div>

        </div>

        <p class="mt-3 mb-0 text-white-50 small">
          &copy; <%= getCurrentYear() %> Career Development Cell. All rights reserved.
        </p>
      </div>
    </footer>

    <style>
      .custom-footer {
        background-color: #0d47a1;
        /* dark bluish */
        border-top: 2px solid rgba(255, 255, 255, 0.15);
        box-shadow: 0 -2px 8px rgba(0, 0, 0, 0.25);
        width: 100%;
      }

      .custom-footer .dev-profile {
        font-size: 0.95rem;
      }

      .custom-footer .social-links a:hover {
        color: #90caf9;
      }
    </style>
</body>

</html>