<% layout("/layouts/userBoilerplate") %>
    <div class="container">
        <h1>Your Test History</h1>

        <% if (submissions.length === 0) { %>
            <p class="no-submissions">You have not submitted any tests yet.</p>
        <% } else { %>
            <% submissions.forEach(sub => { 
                const test = sub.test_id;
                // console.log(test);
                const accuracyNum = test.totalMarks > 0 ? Math.max(((sub.score / test.totalMarks) * 100), 0) : 0;
                const accuracy = accuracyNum.toFixed(2);
                let accuracyClass = "accuracy-red";
                if (accuracyNum >= 75) accuracyClass = "accuracy-green";
                else if (accuracyNum >= 30) accuracyClass = "accuracy-orange";
            %>
                <div class="card">
                    <h2><%= test.testName %></h2>
                    <div class="meta">
                        <p><strong>Score:</strong> <%= sub.score %></p>
                        <p><strong>Accuracy:</strong> <span class="<%= accuracyClass %>"><%= accuracy %></span></p>
                        <p><strong>Start Time:</strong> <%= formatDateTime(test.startTime) %></p>
                    </div>
                    <a class="history-btn" href="/submission/<%= test._id %>">View Submission</a>
                </div>
            <% }); %>
        <% } %>
    </div>
