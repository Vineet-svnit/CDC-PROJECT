<% layout("/layouts/userBoilerplate") %>

<% 
    // Use standardized time utilities (same as admin side)
    const now = getCurrentUTC();
    const upcomingTests = [];
    const activeTests = [];
    const inactiveTests = [];

    for(let test of allTests) {
        const status = getTestStatus(test.startTime, test.endTime);
        
        if(status === 'upcoming') {
            upcomingTests.push(test);
        } else if(status === 'active') {
            activeTests.push(test);
        } else {
            inactiveTests.push(test);
        }
    }
%>

<h2>Active Tests</h2>
<div class="row row-cols-lg-3 row-cols-md-2 row-cols-sm-1">
    <% for(let test of activeTests){ %>
        <div class="col">
            <div class="card p-0 mt-3 border-success">
                <div class="card-header"><%= test.testName %></div>
                <div class="card-body">
                    <p class="card-text"><b>Scheduled date :</b> <%= formatDate(test.startTime) %></p>
                    <p class="card-text"><b>Scheduled time :</b> <%= formatTime(test.startTime) %></p>
                    <p class="card-text"><b>Duration :</b> <%= test.duration %> minutes</p>
                    <p class="card-text"><b>Total questions :</b> <%= test.numberOfQues %></p>
                    <p class="card-text"><b>Total marks :</b> <%= test.totalMarks %></p>
                    <a href="/tests/<%= test._id %>/<%= user._id %>" class="btn btn-primary" id="<%= test._id %>">CONTINUE TEST</a>
                </div>
            </div>
        </div>
    <% } %>
</div>

<h2>Upcoming Tests</h2>
<div class="row row-cols-lg-3 row-cols-md-2 row-cols-sm-1">
    <% for(let test of upcomingTests){ %>
        <div class="col">
            <div class="card p-0 mt-3">
                <div class="card-header"><%= test.testName %></div>
                <div class="card-body">
                    <p class="card-text"><b>Scheduled date :</b> <%= formatDate(test.startTime) %></p>
                    <p class="card-text"><b>Scheduled time :</b> <%= formatTime(test.startTime) %></p>
                    <p class="card-text"><b>Duration :</b> <%= test.duration %> minutes</p>
                    <p class="card-text"><b>Total questions :</b> <%= test.numberOfQues %></p>
                    <p class="card-text"><b>Total marks :</b> <%= test.totalMarks %></p>
                    <a href="/tests/<%= test._id %>/<%= user._id %>" class="btn btn-primary" id="<%= test._id %>">START TEST</a>
                </div>
            </div>
        </div>
    <% } %>
</div>

<h2>Inactive / Past Tests</h2>
<div class="row row-cols-lg-3 row-cols-md-2 row-cols-sm-1">
    <% for(let test of inactiveTests){ %>
        <div class="col">
            <div class="card p-0 mt-3 border-secondary">
                <div class="card-header"><%= test.testName %></div>
                <div class="card-body">
                    <p class="card-text"><b>Scheduled date :</b> <%= formatDate(test.startTime) %></p>
                    <p class="card-text"><b>Scheduled time :</b> <%= formatTime(test.startTime) %></p>
                    <p class="card-text"><b>Duration :</b> <%= test.duration %> minutes</p>
                    <p class="card-text"><b>Total questions :</b> <%= test.numberOfQues %></p>
                    <p class="card-text"><b>Total marks :</b> <%= test.totalMarks %></p>
                    <button class="btn btn-secondary" disabled>COMPLETED</button>
                </div>
            </div>
        </div>
    <% } %>
</div>
