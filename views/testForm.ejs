<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="stylesheet" href="/css/testForm.css" />
    <title>Test Form</title>
</head>

<body>

    <div class="card col-md-4 mt-5 mb-3 mx-auto">
        <div class="card-header">
            <h3>Create Test</h3>
        </div>
        <div class="card-body">
            <form method="POST" action="/test/questions/new" class="needs-validation" novalidate>
                <div class="mb-3">
                    <label for="testName" class="form-label">Test Name</label>
                    <input name="testName" placeholder="Enter name of the test" type="text" id="testName"
                        class="form-control" required />
                </div>
                <div class="mb-3">
                    <label for="date" class="form-label">Test Date</label>
                    <input name="date" placeholder="Enter date of test" type="date" id="date" class="form-control"
                        required />
                </div>
                <div class="mb-3">
                    <label for="time" class="form-label">Test Timing</label>
                    <input name="time" placeholder="Enter time for the test" type="time" id="time" class="form-control"
                        required />
                </div>
                <div class="mb-3">
                    <label for="duration" class="form-label">Test Duration (in minutes)</label>
                    <input name="duration" placeholder="Enter duration" type="number" id="duration" class="form-control"
                        required />
                </div>
                <div class="mb-3">
                    <label for="branch" class="form-label">Select Branch</label>
                    <select class="form-select form-select-lg" id="branch" name="branch" required>
                        <option value="" disabled selected>Select branch</option>
                        <option value="lr">Logical Reasoning and Aptitude</option>
                        <option value="ai">Artificial Intelligence</option>
                        <option value="che">Chemical Engineering</option>
                        <option value="chm">Chemistry</option>
                        <option value="ce">Civil Engineering</option>
                        <option value="cse">Computer Science and Engineering</option>
                        <option value="ee">Electrical Engineering</option>
                        <option value="ece">Electronics Engineering</option>
                        <option value="hss">Humanities and Social Sciences</option>
                        <option value="ms">Management Studies</option>
                        <option value="math">Mathematics</option>
                        <option value="me">Mechanical Engineering</option>
                        <option value="phy">Physics</option>
                    </select>
                </div>

                <div id="categories-section" style="display: none;">
                    <h5>Categories</h5>
                    <div id="categories-container" class="mb-3">
                        <!-- Category rows will be added here -->
                    </div>
                    <button type="button" class="btn btn-outline-primary btn-sm mb-3" id="add-category-btn">
                        <i class="fas fa-plus"></i> Add Category
                    </button>
                </div>

                <button class="btn btn-dark w-100">Submit</button>
            </form>
        </div>
    </div>

    <script>
        let availableCategories = [];

        document.getElementById('branch').addEventListener('change', async function () {
            const branch = this.value;
            const res = await fetch(`/api/categories/${branch}`);
            availableCategories = await res.json();

            // Show categories section and clear existing rows
            document.getElementById('categories-section').style.display = 'block';
            document.getElementById('categories-container').innerHTML = '';

            // Add initial row
            addCategoryRow();
        });

        document.getElementById('add-category-btn').addEventListener('click', addCategoryRow);

        function addCategoryRow() {
            const container = document.getElementById('categories-container');
            const row = document.createElement('div');
            row.className = 'row mb-2 align-items-end category-row';

            let options = availableCategories.map(cat => `<option value="${cat}">${cat}</option>`).join('');

            row.innerHTML = `
                <div class="col-8 text-start">
                    <label class="form-label">Category</label>
                    <select name="category_name" class="form-select" required>
                        <option value="" disabled selected>Select category</option>
                        ${options}
                    </select>
                </div>
                <div class="col-3 text-start">
                    <label class="form-label">Count</label>
                    <input name="catNumberOfQues" type="number" class="form-control" min="1" required />
                </div>
                <div class="col-1 d-flex align-items-end justify-content-center">
                    <button type="button" class="btn btn-outline-danger border-0 remove-row">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            `;

            container.appendChild(row);

            row.querySelector('.remove-row').addEventListener('click', function () {
                row.remove();
            });
        }
    </script>

    <footer class="custom-footer py-3">
        <div class="container text-center">
            <h6 class="text-white mb-3">Developed By</h6>

            <div class="d-flex justify-content-center gap-5 flex-wrap">

                <!-- Jenil -->
                <div class="dev-profile">
                    <span class="dev-name text-white">Jenil Prajapati</span>
                    <span class="social-links ms-2">
                        <a href="https://github.com/jenil1236" class="text-white mx-1"><i class="fab fa-github"></i></a>
                        <a href="https://www.linkedin.com/in/jenil-prajapati-b31505307/" class="text-white mx-1"><i
                                class="fab fa-linkedin"></i></a>
                        <a href="#" class="text-white mx-1"><i class="fab fa-twitter"></i></a>
                    </span>
                </div>

                <!-- Vineet -->
                <div class="dev-profile">
                    <span class="dev-name text-white">Vineet Gupta</span>
                    <span class="social-links ms-2">
                        <a href="https://github.com/Vineet-svnit" class="text-white mx-1"><i
                                class="fab fa-github"></i></a>
                        <a href="https://www.linkedin.com/in/vineet-gupta-431396272/" class="text-white mx-1"><i
                                class="fab fa-linkedin"></i></a>
                        <a href="#" class="text-white mx-1"><i class="fab fa-twitter"></i></a>
                    </span>
                </div>

            </div>

            <p class="mt-3 mb-0 text-white-50 small">
                &copy; <%= new Date().getFullYear() %> Career Development Cell. All rights reserved.
            </p>
        </div>
    </footer>

    <style>
        .custom-footer {
            background-color: #0d47a1;
            /* dark bluish */
            border-top: 2px solid rgba(255, 255, 255, 0.15);
            box-shadow: 0 -2px 8px rgba(0, 0, 0, 0.25);
            width: 100%;
        }

        .custom-footer .dev-profile {
            font-size: 0.95rem;
        }

        .custom-footer .social-links a:hover {
            color: #90caf9;
        }
    </style>
    <script src="/js/script.js"></script>
</body>

</html>